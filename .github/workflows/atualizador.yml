name: Atualizar Ofertas DiÃ¡rias

on:
  # Gatilho 1: Agendamento (Todo dia Ã s 06:00 BRT / 09:00 UTC)
  schedule:
    - cron: '0 9 * * *'
  
  # Gatilho 2: BotÃ£o Manual (Para testar na aba Actions)
  workflow_dispatch:

  # Gatilho 3: Ao fazer Push (Roda sempre que vocÃª subir cÃ³digo novo)
  push:
    branches:
      - master
      - main

permissions:
  contents: write

jobs:
  update-offers:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Baixar cÃ³digo do site
        uses: actions/checkout@v3

      - name: ðŸŸ¢ Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: ðŸ“¦ Instalar DependÃªncias (se houver)
        # O "npm init -y" criou o package.json, entÃ£o Ã© bom rodar isso
        run: npm install

      - name: ðŸ¤– Rodar o RobÃ´ Shopee/Nuuvem
        env:
          RAKUTEN_CLIENT_ID: ${{ secrets.RAKUTEN_CLIENT_ID }}
          RAKUTEN_CLIENT_SECRET: ${{ secrets.RAKUTEN_CLIENT_SECRET }}
          SHOPEE_APP_SECRET: ${{ secrets.SHOPEE_APP_SECRET }}
        run: |
          node robo_ultimate_v4.js

      - name: ðŸ’¾ Salvar e Publicar no Site
        run: |
          git config --global user.name 'Robo Play4Fun'
          git config --global user.email 'bot@play4fun.com'
          git add ofertas.html
          # O comando abaixo verifica se houve mudanÃ§a antes de commitar para nÃ£o dar erro
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ”¥ Ofertas atualizadas automaticamente" && git push)