name: Atualizar Ofertas DiÃ¡rias

on:
  # Gatilho 1: Agendamento
  schedule:
    # 16:00 UTC equivale a 13:00 no HorÃ¡rio de BrasÃ­lia
    # Esse horÃ¡rio costuma ter menos falhas que a madrugada
    - cron: '0 16 * * *'
  
  # Gatilho 2: BotÃ£o Manual (Para testar na aba Actions se precisar)
  workflow_dispatch:

  # Gatilho 3: Ao fazer Push (Roda assim que vocÃª salvar este arquivo para "acordar" o robÃ´)
  push:
    branches:
      - master
      - main

permissions:
  contents: write

jobs:
  update-offers:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Baixar cÃ³digo do site
        uses: actions/checkout@v3

      - name: ðŸŸ¢ Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: ðŸ“¦ Instalar DependÃªncias
        # Garante que o fetch e crypto funcionem corretamente
        run: npm install

      - name: ðŸ¤– Rodar o RobÃ´ Shopee/Nuuvem
        env:
          # Puxa as senhas salvas nos Secrets do GitHub
          RAKUTEN_CLIENT_ID: ${{ secrets.RAKUTEN_CLIENT_ID }}
          RAKUTEN_CLIENT_SECRET: ${{ secrets.RAKUTEN_CLIENT_SECRET }}
          SHOPEE_APP_SECRET: ${{ secrets.SHOPEE_APP_SECRET }}
        run: |
          node robo_ultimate_v4.js

      - name: ðŸ’¾ Salvar e Publicar no Site
        run: |
          git config --global user.name 'Robo Play4Fun'
          git config --global user.email 'bot@play4fun.com'
          git add ofertas.html
          # SÃ³ faz commit se houver mudanÃ§a no arquivo de ofertas
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ”¥ Ofertas atualizadas automaticamente" && git push)
